{% load static %}

<!DOCTYPE html>
<html>
    <head>
        <title>Jira Tasks</title>
        <meta http-equiv="refresh" content="600">

        <link rel="stylesheet" type="text/css" href="{% static 'css/jira.css' %}">
        <link rel="shortcut icon" href="{% static 'images/prime_source.png' %}">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    </head>
    
    <body>
        <nav>
            <div class="welcome">
                <img src="{{ avatar }}">
                <h3>{{ fullname }}</h3>
            </div>

            <div class="filter">
                <label>Фильровать по:</label>
                <select id="clients">
                    <option value='-1'>Все</option>
                    {% for values in list_of_clients %}
                        {% ifchanged %}
                            <option value="{{ values.1 }}"> 
                                {{ values.0 }}
                            </option>
                        {% endifchanged %}  
                    {% endfor %}
                </select>
            </div>
            
            <div class="buttons">
                <button><a href="\">Выйти</a></button>
            </div>
        </nav>

        <div class="content" id="tasks-content"> </div>
        
        <script>
            $(document).ready(function() {
                var selectedClient = $('#clients').val();
                console.log('[take]', selectedClient);
                updateTasks();

                $('#clients').on('change', function() {
                    selectedClient = $(this).val();
                    console.log('[change]', selectedClient);
                    updateTasks();
                });

                function updateTasks() {
                    $.ajax({
                        url: '/board/',
                        data: { 
                            'client': selectedClient,
                        },
                        type: 'GET',
                        success: function(data) {
                            $('#tasks-content').html(data.html);
                            console.log('[load]', selectedClient);
                        },
                        error: function(jqXHR, textStatus, errorThrown) {
                            console.log('HTTP status code:', jqXHR.status);
                            console.log('HTTP status text:', jqXHR.statusText);
                            console.log('errorThrown', errorThrown);
                        }
                    });    
                }
            });
        </script>
    </body>
</html>